%this program will find the common motif from DNA sequences
%input DNA sequence, motif size
%output motif

rng(0,'twister');
numberOfDNASeqs=2;
DNASeqs=cell(1,numberOfDNASeqs);
% DNASeqs(1,1)={'ATAGTATAGTTTAACCACACAAAGGCCAAAATAAATTAGAGAAGTCTGGGACAGGCCCACTTCCTCTTCTTTCATTAAACAGACGGACAGGGCCTATACAACTCACATTAACCACACTTCCTCTGGCGAGAAACGTGGTTGTATGGCCACATACATGGAAGGAGTGTGAGGCAGAGACTCTGATCCTGATGTAGAGGTTTTGCTGAAAAGGAACCCTCCTCCATACCGCTTAACAGATTGTTTCAGCATCATGAGCAAAAaattgcgtaagcATTTTTTTTTTTCTGAAAATCCCAGGCTTTTTTGGTAACTGTGCTCACCGCGACTGATAGTATGTGCAAATTGATTGCGCTCTTTTATCGAATATTTCACAAATCCAAATGTCAGCTCAGCTGGAAAAAACATGCTGTGGAGGGACACGGTTACCCCTTTATAGCTTCTACAGTGCAACACAATGGACAGCGGACAGTATAAATTTGGCGCTCTTGGAAACTCATGACACAGCTGGGAAATCCAGTGCACATGCAGTTTTAGTTGTGAAACTACCTATACTGACCGCTCAGTAAAAATCTTCCTGGGAACAAACTTCGTACGAGCTCTTAATCTGCTTACACCCTTGAATCACAGGTGAGCTGCCCCCAACGTGGATGAGGCTGATCTTATACAAAGATAGATGGGTCTCATATTTCTCTTCCTGGGGAATCCTGCGAGTTTGGGCGGAAGGACGTTTATATGCAGAAGGAGGAAAATAGAGCCAACGCCTGAGCAGAAGAAAGAGCCCCAGAGTCTAGACCTCAGTACTGAGTCAGGGTGAGAGAAGCTCCACACCCAAATGAGACTTTGCAGGGTATGTCCTTCCCAGCTAAGGAAACTACAAAAAGAGCACTTCAAAGAAATCTCATGAAAGGGTACTTTTGCTCCTTTCCCCACGAGGGAGCTTCTAAGGGGAGGTTTCTAATTGGGGGAAAGAGCAGGTAAGCTTTCAATGGGTTTCTTCCCCCTATGAAAGCAACTCCTCAGCGCGAGAAAACAACACTCAGATGATGTGTTCCTGGAGCTGGGAACAATACGGCGAGGTGAGTGATGGGAGGCTCTGTATACGCATGGAATTATATAAATGTGGGTGGTTAGTGGGCATTTTATTTTCCAAAAACCAGCATGCTAAGACATTAGAAACTTCTGGCAGCTTATTATAAATCTGATGCAAAGAGGAGATGCAGGGTAACCCCCAGTTTTAGTTTTTGCGTGGTGGAAGTGAAATAATCTGCATTTACCCGAAAGGTTTAATGGCGAATTCAGACTAAAGCAGATCCAGCAGTACGTCAGAAACCTTCTGGAGTTGAGGTTACAGTAGGCCAGTGGGGAGATGAGTGTTGTCCTGCCAAGAGCTCTGAGTGACCTGGTCTAGGGAATGAAGGTGTACCCATGAGTGGATGAAAGACCCAGGATTAACAGTGGAACATAGTTCACCCAGGACAGTCTTACCACTTTTTTGTGATCAGCACAGAAATATATATTTCCTCAGCAGAATTCAGTCTCTACACCAGGAGCAGGTCAGTGCGCTTCACACATACCCAAAGCCCAGTGGCTCTGCTCCTTTTCTTTCAGAGAAAGTTTACCTTAGTGAGTACACCAGATTCTATCCGAAAGAGTTCCCAGTCTGGTTATAAGAGCCTGGCTCTATGCGCAGTACCCCTTTCTTCCTGGCCCTTCTTCCTCAGCAACCCGCCCTACTCTCTGCCCACTTTCATAAAGGATAGCCCAGCTTGCGCGGGAGTTCTGTCAGCGCCAGCTCCCTTTTAGGAAGAGTGGCTCCAAATGGTTTTGTGAGCGTGAGACCAAACTCTCCATGTGCCCTCTACACTCAAAGAACCGCCTGCGCTTTCCAGCATCATAAACTCTAATTCTGCTTAATTACACTGTTAGACTCTGTTTAGGAAAGAGAATTGCTCTCTCTCTTCTGCTGGGATATATACACT'};
% DNASeqs(1,2)={'ATTTTGACAGCAGGAATAAGGGCGCCTGAAAACTTTCTCCCTCCCTGTGTGGAAAAGCTGTGCGCTGCTATACTGGGGCAGTCAACCCTTTTATGAGATGAAAAAAGCAGCTAAGATTTCATAATGTATGTGTATTTCTAAGCAGCCGCCTCCTCTCTGGGCTGAAACAGCAAGATAAATGCTTTCCATACCTAAAGAAATTTGCTTTACACAGAGAGAAATTTCTGACAGAACTTTCTTGTGGGCAGGTgattgcgccatcATGCTTTTGCCAGGATATTCTTTAGCAGACTTTAGGCAGAACTGGA'};
% DNASeqs(1,3)={'AGGAGAAACATTTTTTAAAAATCTTTCGCCGGGTGGTAGATGTGGGAAGGCAGCCAGGTCACCATCAGGAACTGATGAAAATATGTGCCTGTTCTATGAGATATTGCTAAATCAGCAGCTTTTTTGCAGGGAAAAGCTTTCTGACGcattacaaaatcGTCGGTGTATAATCATGGGAAAGAGTTGTTAAGGGGCGGACCCAGGTG'};
% DNASeqs(1,4)={'AGGACCTGAGTACAGAATTAGATGGACTAGACTCCAACCCAAAAAGAGAGTGATCTGTGTGCTGTCCTCCCTTAGAAGCTGATAAAAATTATAAAGGGGGTAGGTTCCCTCCCTGTTTGCCTTTTCTCTGTGTCCCATCCTAAGTGATCCGGCAGAAGGAAAATGGAAATTCCGCAAAAATACACCAGATTTAGCTGTGTAGGTTTGTGCGAGATCTTCTGCGCCTCCCATAAGGGGAAGTGCACAGAAATTGAGGCGTATCTTCCCGACTTCCTTAATTAGACTGGACCGAAAACAGGGCTCAGCTCGTCATCATCCTCCAACATCCCACAACCTGCGCTAGTGAGACCTCATCCCTCCTGGGTTACCTCCTAAAGATCTGTAACACCGAGGCATACTTTAGGAGAACCCCATAAGGTTAGTCTCGAGTGATTTGCTAGTGGCGAATCATACTTTCCTATGAGACTATGCAGTGAAAGGCTCTCTGTGCTCACAGTTCTTAGAGGCCTACGTGGGACCCGTCGCCCTCCAGAAGACCGCTGCCCTGcattgcccaactAAATAACTGAAGGGGTTTTTTACCCATAAAGCCCCCTTATACATGATATGGAAGTGCAGTTAGCAGAAAACCTCCCTGAAAAGTGTGATGTTGCAGGCCATATTAAAAACCTGCTAATCTCCTTTTCCTGCTAAAGTCCTGAAAGTTGCGGACCTCTGAAAACAAGATCAGTCGAGCTCCTCATTGTGAAGAATCCTACTACATATTTCTCTTCCTGGCTTTGCCATTTTTCTTAAGTAAAATTCATGAGTTAAAGTGACTGTGGAAGTTTACAACCACAGGGCGTTCTGGGTGAGACCGGGGCAAGGCGCCTTCCAGGAGGGAGAATTCCCGGTTAAATTTGATCCTTCTTCTCTTATAGTACAGGTTATTCCCAGGCTGTCTCCAGACACAAACAGCAGAGGCATTGAGTATAGCACCCTCTTCCACATGAGCAGGTTGTAAACATGGACTGATCTGCTGAACTCGGGCACCATGTGTCACGTGGGGTGGGACCCCCAAAATAAAACCGTGACCTTCCCACAAATACTTAATCTCCAGCCCTCTGTAAAATCACCCGGAGCACAGGCTCATGTAATCAGCATTCACAGAGGCACATGTCGGGTCACCGCGCTTTAAACAGCGCTAAAATTTTAAAACACTGGGAGAAACTTCTCATGGGAAGAAAGGGCGGGACCCACACATTTTCTCTCGGAAAATGCAGCCAGTTTGTGCATACTGAGATGCACTTCTGGAAGTCTGGGGCCATATCTCTGTTAGTATAAAATATATCTGCATAGGTGCTTGTGATGGGAAAGGAGGAGTCCCAGCCATTTTTCATCAACCGCCCGCAAGGTTCTAGCCTGTACTCCTATCAGCTGTCGGTTACAGCGCCACCCACAGATTTGCATCTCCTTACATTTAGGACACACGAGTTATGAAATTTCCAGGGATACCGAGTAAAAAAACACTTTCTCCATTCACATTCCCCGCGGAGATAGAAGACTTGCAAAGCCTGTATCACTTATTTCAAACTGGACAAAAATAAATTTCAGCTCAAGCAAGATACATGAACTGCCTGGCCAGGATACAATCTGAGGCAGATGGTATTTTCCTTACCCCCTCCTGGTCATGAGGGGGCCTGTCTTTGTCATAAGACGTGGCTTCGGGGAGACCTCATTCTCTTTTTAGAGTTTTCCATTCCTGCATGTGTACTGTGAGGGTTTATAGGCAATAATTTTCCTTGGCCTTCATTTAGAAATGACCTGGCCGCCCTCTCTTGGTGACTGTAAAAATTTGCATAGCATGAGAGTATCTTCATACTCCCACCTTTTTGGCCCAAAGTCCAAGGGTTTCAGTCACGCC'};
% DNASeqs(1,5)={'CGCTGGTATTGCGGTACCTCCAGAACCTGATAACCATGGTACCGAGAGCGGGTTGGTGACAGCAATAGTGTCTGGGAAAGGAGTTGAGTTGTGTACTTTCACCTGGAAGAAAGATATACATGAGACTGGCGGTGTTGCAACGTCTGGAACCAGTTGCGGAAAGAGTTATACCAGTAACCAGCTACACTGGGGTTGCATATACACTCCCTAAATTTCTGTCTTTAATAAACCTGCCCATGAAGGCGCATCTGATTTTTAAGCATAATTTAAGAGACCCATGCCTTTACAAAGGCTCTTCACTAGGAAAACCTTGGGCTGGTTAATTTCGTGACTTACAGCGTCGGAACTATTGCTGCTTATTGTACTACTCCTGAGAGGGAAAAAAATGACCCCATGAGAAGCGAGGCATTTTTCACCTGACACAGCAGAAAATGTTAGGTGTCTAAGCTCATAGATTTCTTGCTTCTCTGCTCTGTCATAACCGCTCATTAGGAAGGAGGGTACTCCGAGGAAGAGAAATATGCTCCTCTGGGGAAAAATGTCTTGCTTTTTTCCATTGAGCGTAAGGGAAAATTCTCGAGGTCTATCCTGGGCCCCAGATGTCCTGTCAATGACGGGCCAGGACTCCGTCACGTGATGTGGAAAATTCAGGTGTGGAGCGCTCAGGTGTCTTTGTATAATATCTGGAGGAAAATGTGGGCCAGCGGGGGCAGTTACTTTTAGCGGCTGTTCTTCTTCACGTGGGGGAGCACAGAAAAACACACTCGACTTTCTCCAAGGTCACACATGGACTCCAGTGCAGCACGCCAAACTGTATTATGGGGCTGAACAGGCTTATAAGGTTACTACGGGAATGTCACCAGTCCTTATAACATCCAGGCGTCACAGCCAGCTTCTAAACCTACATGTTTTCCCTATAATTGCCAAAATATGTGCTCCTGGCGCTGGACTAGCCGCGTGAAAACATGGATCCTTCAAGATTGAGACAGTCTGTGAGAGGACAGCAGTGTTAAATGTGTAAATGAGACAGAGTTTTCTGAGGGGAGTTACCAACATGTAGGAGGAGTACACGTGATTGGTCAGCAGCTTTTTGCCCTCCATCATCTTAGTCCCTCAGTGCTCCATCACCTCAAGCCAGAAGCAGCACCGCAACAGGGGCGTACCCATACTGCTGGATATGAAACTCACACCCACTCACTGGCAGAGACACGTCAAATAGAGCTGTCCTCTTATAAATGGACGGCTTTTCTCAAATAATTTCCTCTGGGTGAAGTTATCCTGCAGTTGTCCTTGTCCCTTCGTTACCGAAATCGGGTTCCACACCAATAAGTGTACCTCCAAGTTTCAAGAGGAGTGTTCAGTCATGTGCGCTAGACTTTTCTTCCAAAGTCATCTACTGTCCTGTGATTATTCCTCACAAAATATAGATCTGTTTTTCATACAACCTCGGACATATTCCTTTCAAACCCTCTGAAGCAGAGGGGGGACCTCAGCCATCTGGTGGATCATTAATGAGAGATCCTGTACAACTGGACGTCCACAGGGGTCTAGTCTCCTGAGTCATACAAATTTTCTCTCCCTCACACAGCCTGAAATTTCTACTGGGACCTACCCTCCTTAAGATGAAAACTCCCCACATGGGGTTTTAGAGGACCTAGATAATGAGGCTCCACTGTAGAGAACTGCTTGAGGCAACTTTCAGAGTAAAGTTGTGGTTACCTCTTTTCTCGGAGCAACCATGCTCTTGCTACTGTAAGCCTTTCACTCCACACCCTTAAGTCAATCTAAAGAAGGTCTTTCCTTCTAAATGGGGTGAGTTCATGTCACAGCCTTGCAGAAAAGGAATGATGGGGGAATCTCACAATAGATTTACTTCCGACCAgtttgcgccactGGAGAGAGGTCATATTGCGCTAGGAGCGCATGCAGGCGGACACCTTCTGACATGGGCTCCCCGCTTCAGACGGAGAGGCGTTGTATATTAGGGCGCTCCCATCTAA'};
% DNASeqs(1,6)={'ACACCATGTACACCCGACTCAGCGTTTCTACCAGTCCTCAACCAGCTATCCCCTCGGAGGTGAGGAAGGCTGCTGACCTCATTAATACATTTTTACTCAACTTCATTCTCTTTTCACGACACTACTATTAACCCAACaattgcgtcattACAAGCAATTTTTCTCCTTCTTCTTATATATTGAAGACGCTGGCGGTACAGGGTACCTCTCAATAAGGGCGTCAAATATGTTCCTGCAGACTTTTTAGCACGAGGGATGAAGAGTGTGCGGCTTGTTCTGTATATACTGAATACTTATAGATCATGAGAAATTCTCCTGGGCCTCTTGGCCAGACTAGTGGTGGAGGACTATTTCTTACAGAATTACAATGAAGCTAATGACTCACACCTGTAACACTAAACGGTCTGTAGAGACCAGAGTGGGTACCCGCGCTGGGAAATACTGGAAAAAATTTTCCATCCCAGGGAATGTGCATCCTTTCCCAATTTACAAGGTC'};
% DNASeqs(1,7)={'TTTGTCTTCGCGGCGGCGCTGTCACATGTGCTCATGGAGTAACCCAAATTTGTCTTGGACCATATGTGGAATCAGTTCCCCACCTGAATGACTGGTGGCTCCGCCTGGAACAGGGGGGTGGGATGCAGAAAGATTCATTTCCCGCATTTCACACCGCTCGTCTAACTGGCGCTGAGAATATTTTTAGGTCTGGGTTCTCACAATAGGCTTTATGGAGAGGAATGCACCCAATACCCTCATAGAGGGCTGTGTAGACTCGTCCTTTCAGGCGGGAAGGTTCACAAAAGTCGATTTTCCTTTAGAAAAGAGCTTGCCTGATATGTTACAGCAGGCGCAGTTTATACACACAAGGTCTAACTGAGGCTTGTCCACTCTGTGCCAGAATTTTATCCCGAGAGGGGAGCTTTTTTCAAATGAAAAGGGGACATTTAGAGGAGACCCTTCTCCTTCACCTATCCATACTGCTTGGGGGGTATGTCATTACCTCTTGGAAGCTTATGTTTACTTAATGTAAATCAGGACGTCGCTGAGCTGGTAATTAGATCTTTTTTCCCCAGACAATAACTTCCTGGCAGCGACCTGGAATCCTACTGTCTCTGATGTTGAGTGGTTTACTGGAGCCTTCCAGCTCTGGGGTTCTGGGAGGAAAGTTTATTTGAGCCAAATGCGTATTTAGCAAACACTCTTCCTTACTAAAGTGGGATCTGAGATTTCCCTTTGCACAACTGTCTCGCCCCTCCTTCCATTATATAATCTTTTCCTCCTTAATTAATTACCTGGAAATGAGAGTTCCAAGAAAAGCAATCATTTTGTTACAGGAGGTCCTGGGGGTATAGGAAAGCCCCGGATATTAGTTGCCTCTCAAAAAAAGAAGCAGGGAATATTCCTAACAGACCGGATAACACAGACTCTGTCAATTAATTTACTTACTTTTTTTGTCTGTGGACAGGACAAGTTTACTACGAAAATTGTGAACAACAGCTTCAGTATAACACACCAAGGCACAAGTGATGGCTCCAAGTACGTCATTAATTCGCTGGGAAGTGATGGGGAATTCCAGGAAGGGCTACCTATAAAACCTCCTTTCTTATAACCGCGCCTTGATCCTTATGTCCATTTGATATCAGATGTGTGCTCCTCCGCCTCTTGCCTCGCCATGAGGGGACGAGCCAGGAGTCATAAATAAGGATGGAAAATGTACGTTGACAGCTAAGACACGTCCTGTGGAAGAAATGTCTGGGTTAGAGGAAAAAGGCATCCATGAATTTCACGAAGAACATGTGTAGTGCTGGGGGCGCGTCTCTGCTGCGTGTCAATAAGAGGCCTGGGTTTAGGGGTTGGAGGAGGATATTAGGAATAACACCCGATCCCCCTCCAGCGGCATACATTGCAAATGGAATAAATGTATAGTGGAAATCAGAACATTTAGAAAATTTTCTCGGGAAGCAGATGTAGCTGAAGCAGCCTTATAAATGTCGAGGGGAGGGAACCCATAATGTTCTGATGACCTCCTTCTGCTTCTCCTGGTTTTCTTTTAGAATGTGCAGAAGGAAAAATTTTCTGACTAAAATCAGCGTACAATGTTGGCTCGGACCTCGCAGTAAATACCAGTCCTAGGAATGAACTGGAGAATGTCAGCATTCATACTCCCAGATATTCATGTGCTACACACCCTCAGATAGAAGGGTGGACAGGCCTGAATTCTTACAGACAGATCTTACTGAAATGTTTACTCTTAGCCTGATTCTATATAAAATCACACCACCTGGGACCTGAGATcatttcgtcacaAAGGTATCTGGCCAACAGTGGAGTTCCTAGATGCATGTACAGCTTCCAGACGTCTGACTTCCCCTGTTAGGGTGCTTGTACCCCGCCTTCAGTCTTGTGTCACTTCTGTGGAGGCTCCAACCATTCTGGATTTACTACCGAGAAGGCGCAGTGTGTCGTGACAGTGACGGAATCTTTTATTGTGGGGC'};
% DNASeqs(1,8)={'GCCTACACACGGGTTCTCCCCCAATTCCATTCATTTTAATCAGGAAAATAAGCTTTCCGCAAAACCATAATATGGTGGCAGAAGAAGAATCTTTCCCACTAGGGACACACTAGACCAAATATAGCTTgattacatcactTGACTCAGCATGAGCTCCATGTAAAATAACATGCGGACTGGCCCAAGTCATTATACTAGAGTAGTTCGCTGTGGAAAGTTGTGCTAGCCCACAAAGGCTCCTTACCAACTTGCTCGTTGGATTTTAATAGTGGCACAGAAACTGACCACACTGCCTGGAGAGATCAGATGCTTATACCACCGCCAGAAGCAATTGCACTCTTAGAAGTTCCCGCAAGAGAGATGTGGCAGAGCAATACACCTGCCAACATGTGAGAGCAAGCATGGCGGCATTATCCATGGGGAATGTCTCCTCCATGTGCATCCCTCCATGCTCTACCCAGCTGGAGAGTTTATGCAGAATAGAGACCGTTGCCTTTCCGCAATTACATTT'};

% DNASeqs(1,1)={'ACCATGACAG'};
% DNASeqs(1,2)={'GAGTATACCT'};
% DNASeqs(1,3)={'CATGCTTACT'};
% DNASeqs(1,4)={'CGGAATGCAT'};

%  DNASeqs(1,1)={'AAAATCCCTT'};
%  DNASeqs(1,2)={'GGGTCCCAAATTTTT'};
%   DNASeqs(1,3)={'AAAATTCCCTTTT'};
%  DNASeqs(1,4)={'GTCCCGCCCCCC'};

%extreme testing: should run 5000 times but still cannot find the motif
DNASeqs(1,1)={'AAAAAAAAAAAAAAAAAAAAAAAAAAATTTTTTTTTTTTTTTTTTTTTTTT'};
DNASeqs(1,2)={'GGGGGGGGGGGGGGGGGGGGGGGGGGGCCCCCCCCCCCCCCCCCCCCCCCC'};
motifSize=5;
beta=0.5;

%initialization
pickedSeqInd=pickHiddenSeq(numberOfDNASeqs);

%pickedSeqInd=1;%debug
[ motifLocMat ] = chooseRandomMotifPosition( numberOfDNASeqs,motifSize,DNASeqs,pickedSeqInd );
%motifLocMat=[-1;4;4;2]; %debug
counter=1;

while(counter<5000)

        
        [ residueOccMat ] = countResidueOccurrences( motifSize,DNASeqs,motifLocMat,pickedSeqInd );

        [ freqCountMat ] = frequencyCounts( residueOccMat,numberOfDNASeqs,beta );


        [ weights ] = calculateWeightsForHiddenSequence( DNASeqs,freqCountMat,pickedSeqInd,motifSize );

        [ normalizedWeights ] = normalizeWeights( weights );

        [ hiddenMotifPos ] = drawRandomSampleFromNormalizedWeights( normalizedWeights );
        %hiddenMotifPos=2;%debug
        [ motifSeqs ] = getMotifSeqs( DNASeqs,motifSize,hiddenMotifPos,motifLocMat,pickedSeqInd,numberOfDNASeqs );
        
        motifLocMat(pickedSeqInd,1)=hiddenMotifPos;
        hammingDist=getHammingDist(motifSeqs,motifSize);
        if(hammingDist<0.1)
            break;
        end
       
        
        disp (counter)
        disp(motifSeqs)
        counter=counter+1;
        pickedSeqInd=pickHiddenSeq(numberOfDNASeqs);
        motifLocMat(pickedSeqInd,1)=-1;
        

end

disp ('final motif sequences:')
disp (motifSeqs)

